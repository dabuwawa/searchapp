function getScreenDom(e,t,a){return $(e+":visible").filter(function(){var e=$(this).offset().top;if(e>0&&e>=t&&e<=a&&!$(this).data("success")){$(this).data("success",true);return true}return false})}function doPriceHtml(e,t){var a="";if(itemType[e.priceType]=="tuanqiang"){a+='<span class="promotion-normal">真划算</span>'}t.find(".price").text(e.price?"¥"+e.price:"").after(a)}var itemType={GOMEPRICE:"normal",SALEPRICE:"normal",AREAPRICE:"normal",AREASALEPRICE:"normal",TUANPRICE:"tuanqiang",RUSHBUYPRICE:"tuanqiang"};function doItemHerf(e,t){var a="",r="";switch(itemType[e.priceType]){case"normal":a="//item"+cookieDomain+"/"+e.productId+"-"+e.skuId+".html";r="#gm-other-info";break;case"tuanqiang":a="//tuan"+cookieDomain+"/deal/"+e.promotionUrl+".html";r="#j-comment-section";var i=t.find(".addTo-cart"),n=i.attr("data-code");i.undelegate().replaceWith('<a class="add-cart" href="'+a+'" target="_blank" data-code="'+n+'">立即购买</a>');break;default:break}t.find(".item-link").attr("href",a);t.find(".comment").attr("href",a+r)}function priceInterval(){var e=$(window);var t=e.scrollTop()+e.height()+300;var a=e.scrollTop()-300;var r=getScreenDom(".ancyPrice",a,t);var i=getScreenDom(".nSearchWarp img",a,t);if(r.length>0){$.each(r,function(e){var t=$(this),a=t.parent().find(".productInfo"),r=a.attr("pid"),i=a.attr("sid"),n=t;$.ajax({type:"get",url:["//ss.gome.com.cn","search/v1/price/single",r,i,pageData._bdarea_2,"flag/item","fn"+e].join("/"),dataType:"jsonp",jsonpCallback:"fn"+e,success:function(e){if(e&&e.success){if(n.parent().attr("class").indexOf("product-item")!=-1){doPriceHtml(e.result,n.find(".item-price-info"));doItemHerf(e.result,n)}else{n.parent().find(".ancyPrice span").text(e.result.price?"¥"+e.result.price:"")}}else{t.data("success",false)}}})})}if(i.length>0){$.each(i,function(e){$(this).attr("src",$(this).attr("gome-src"))})}}