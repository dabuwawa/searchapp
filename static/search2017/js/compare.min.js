var searop_domian=cookieDomain;if(window.location.href.indexOf("gomehigo")!=-1){searop_domian=".gomehigo.hk"}var compare={compareBoxes:null,compareNewTpl:function(){return'        <ul  class="clearfix" >            <% for(var i=0,l=items.length; i<l; i++){ %>            <li class="compare-items add">                <input class="productInfo" pId="<%= items[i].pId %>" sId="<%= items[i].skuId %>" type="hidden"/>                <p class="pic">                    <a target="_blank" href="<%= items[i].pUrl %>" title="<%= items[i].pName %>">                        <img alt="<%= items[i].pName %>" gome-src="<%= items[i].pImg %>_50.jpg" src="//img.gomein.net.cn/images/grey.gif"></a>                </p>                <p class="name">                    <a target="_blank" title="<%= items[i].pName %>" href="<%= items[i].pUrl %>"><%= items[i].pName %></a></p>                <p class="price-wrap ancyPrice">                    <span class="price"></span>                    <a class="del" onclick="javascript:compare.delElement(this);" sid="<%= items[i].skuId %>" pid="<%= items[i].pId %>" track="对比栏:删除" href="javascript:;" style="display:none;">删除</a>                </p>                <s></s>            </li>            <%}%>        </ul>        '},addToCompare:function(e,a){var o=this.inCookie(e,a);if(o=="add"){this.compareBox();this.compareShow();$("#j-backtop").addClass("after");tool.setCookie("g_co","show");this.addClass()}else{}},compareTemplate:function(e){if(e==null)return 0;var a=1;$.ajax({type:"post",url:cloudSite+"/cloud/compare",data:{id:e,type:0,module:"compare",from:"compare"},cache:false,dataType:"jsonp",timeout:5e3,jsonpName:"callback_compare1",success:function(e){if(e.compare=="no"){compare.clearCompareBox();a=0}else{var o=$("#compare");if(o.length==0){$(".compare-bd").append("<ul class='clearfix'></ul>")}var r=$("#compare");r.innerHTML="";var i=template.compile(compare.compareNewTpl());var t=i(e);r.html(t);var s=tool.cookieSize("compare","|");$("#pCount").html(" ("+s+")");$("#backCompare").html(" <s></s>("+s+")");var c=compare.addOtherHtml(s);$("#compare ul").append(c);compare.blind()}}});return a},inCookie:function(e,a){var o=tool.getCookieValue("compare");if(o==null){var r=e+":"+a;tool.setCookie("compare",r);return"add"}else{var i=tool.cookieContain(o,a);var t=tool.cookieSize("compare","|");if(i){compare.error("该商品已经加入对比！")}else if(t==4){compare.compareShow();$("#j-backtop").addClass("after");tool.setCookie("g_co","show");$(".display-page-compare-checkbox").attr("checked",false);compare.error("对比栏已满,您可以删除不需要的栏内商品再继续添加哦！")}else{var r=o+"|"+e+":"+a;tool.setCookie("compare",r);return"add"}return"unadd"}},compareBoxInit:function(){var e=tool.getCookieValue("compare");var a=tool.getCookieValue("g_co");if(e!=null){this.compareShow();$("#j-backtop").addClass("after");tool.setCookie("g_co","show")}this.compareTemplate(e)},compareBox:function(){var e=tool.getCookieValue("compare");var a=tool.getCookieValue("g_co");if(a==="show"){this.compareShow();$("#j-backtop").addClass("after");tool.setCookie("g_co","show")}this.compareTemplate(e)},collectSIds:function(){var e=tool.getCookieValue("compare");var a=new Array;if(e==null)return null;var o=e.split("|");for(var r=0;o!=null&&r<o.length;r++){var i=o[r].split(":");a.push(i[1])}return a},addOtherHtml:function(e){var a="";var o="";if(e==0)a=a+'<ul class="clearfix">';for(var r=e+1;r<5;r++){a=a+"<li class='compare-items'>"+"<p class='pic'>"+r+"</p>"+"<p class='txt'>您还可以继续添加</p> <s></s></li>"}if(e<2)o="disable";a=a+"<li class='compare-items last'>"+"<p class='btn-wrap'><a track='对比栏:对比' target='_blank' class='btn "+o+"' onclick='javascript:compare.doCompare();return false;' href='javascript:void(0);'>对比</a>"+"<a track='对比栏:清空' class='btn-clear' onclick='javascript:compare.clearCompareBox();return false;' href='javascript:void(0);'>清空对比栏</a></p></li>";if(e==0)a=a+"</ul>";return a},compareInit:function(){this.reload();this.addClass();this.compareBoxInit();this.toggle();var e=tool.getCookieValue("compare");var a=tool.getCookieValue("g_co");if(a!="show"&&e!=null){$("#backCompare,.f-compare-text").show();tool.setCookie("g_co","hide")}var o=compare.collectSIds();if(o==null){return}compareBoxes=$(".display-page-compare-checkbox");if(compareBoxes.length>0){compareBoxes.each(function(){var e=$(this);var a=e.parents(".item-tab-warp").attr("sid");for(var r=0;r<o.length;r++){if(a==o[r]){e.addClass("click");e.attr("checked",true);break}}})}},doCompare:function(){var e=tool.getCookieValue("compare");var a=tool.cookieSize("compare","|");if(a<2){compare.error("至少有两件商品才能对比哦！")}else{e=e.split("|");var o="",r=e.length,i=4-r;for(var t=0;t<r;t++){o+=e[t].split(":")[1];if(t<r-1)o+="-"}if(i>0){for(var t=0;t<i;t++){o+="-0"}}e=o+".html";var s=staSite+"/compare/"+e;window.open(s,"_blank")}$(".compare-bar .hd .more").click(function(){var e=compare.collectSIds();if(e==null){$("#backCompare").hide();$("#f-compare .f-compare-text").hide();$("#j-backtop").addClass("after");tool.setCookie("g_co","hide")}else{$("#backCompare").show();$("#f-compare .f-compare-text").show();$("#j-backtop").removeClass("after");tool.setCookie("g_co","hide")}$(".compare-bar").hide("1200")});$(".compare_lesat").bind("click",function(){$(this).addClass("hover").siblings("li").removeClass("hover");$(".compare-bd").hide();$(".js-cbox").show();historyView.historyTemplate()});$(".compare_li").bind("click",function(){$(this).addClass("hover").siblings("li").removeClass("hover");$(".compare-bd").show();$(".js-cbox").hide()})},delCompare:function(e){var a=tool.delCookieById(e);if(a==null){$("#backCompare").hide();$("#f-compare .f-compare-text").hide();$("#j-backtop").addClass("after");tool.setCookie("g_co","show");this.clearCompareBox()}else{tool.setCookie("compare",a);this.compareBox()}},clearCompareBox:function(){tool.clear("compare");this.removeClass();this.backToZero()},delElement:function(e){var a=false;var o=$(e).attr("sid");var r="";compareBoxes=$(".display-page-compare-checkbox");if(compareBoxes.length>0){compareBoxes.each(function(){var e=$(this);var i=e.parents(".item-tab-warp").attr("sid");if(o==i){a=true;r=i;e.removeClass("click");e.attr("checked",false)}})}if(a){compare.delCompare(r)}else{r=$(e).attr("sid");this.delCompare(r)}},backToZero:function(){var e=this.addOtherHtml(0);$("#compare").html(e);$("#pCount").html(" ("+0+")");$("#backCompare").html("<s></s>("+0+")")},blind:function(){$(".compare-bd li.add").hover(function(){$(this).find(".del").show()},function(){$(this).find(".del").hide()})},reload:function(){$("#product-box").delegate(".add-contrast","click",function(){var e=$(this).hasClass("click");var a=$(this).parents(".item-tab-warp");var o=a.attr("sid");var r=a.attr("pid");if(e){compare.delCompare(o);compare.removeClass()}else{compare.addToCompare(r,o)}})},addClass:function(){var e=this.collectSIds();if(e==null){$(".compare-bar").hide();$("#j-backtop").addClass("after");tool.setCookie("g_co","show");return}compareBoxes=$(".display-page-compare-checkbox");if(compareBoxes.length>0){compareBoxes.each(function(){var a=$(this);var o=a.parents(".item-tab-warp").attr("sid");for(var r=0;r<e.length;r++){if(o==e[r]){a.addClass("click");break}}})}},removeClass:function(){compareBoxes=$(".display-page-compare-checkbox");if(compareBoxes.length>0){compareBoxes.each(function(){var e=$(this);var a=e.parents(".item-tab-warp").attr("sid");e.removeClass("click");e.attr("checked",false);var o=compare.collectSIds();if(o==null)return;for(var r=0;r<o.length;r++){if(a==o[r]){e.addClass("click")}}})}tool.setCookie("g_co","show");this.compareBox()},error:function(e){$("#errorCompare").html("<em>"+e+"</em>");$("#errorCompare").show();setTimeout("$('#errorCompare').hide();",6e3)},toggle:function(){$("#backCompare").click(function(){var e=tool.elementStyle("compare-bar");if(e=="block"){$(".compare-bar").hide("1200");$("#backCompare").show();$("#f-compare .f-compare-text").show();$("#j-backtop").removeClass("after");tool.setCookie("g_co","hide")}else{$(".compare-bar").show("1200");$("#backCompare").hide();$("#f-compare .f-compare-text").hide();$("#j-backtop").addClass("after");tool.setCookie("g_co","show")}})},compareShow:function(){$(".compare-bar").show();$("#backCompare").hide();$("#f-compare .f-compare-text").hide()}};var historyView={templateToProcess:null,historyTemplate:function(){var e=this;var a=tool.getCookieValue("proid120517atg");if(a==null){$(".nSearch-recentVisit").hide();$(".compare_lesat").hide();return}else{a=a.replace(/\-[^\"]+\"/g,'"')}$.ajax({type:"post",url:cloudSite+"/cloud/compare",data:{id:a,type:1,module:"compare",from:"compare"},cache:false,dataType:"jsonp",timeout:5e3,jsonpName:"callback_compare2",success:function(a){var o=$("#history");var r=$("#recentVisit-lists");var i="";var t="";if(o==null)return;if(a.items){for(var s=0;s<a.items.length;s++){var c=a.items[s];i+='<li class="compare-items goods"><input class="productInfo" pId="'+c.pId+'" sId="'+c.skuId+'" type="hidden"/><p class="pic"><a target="_blank" href="'+c.pUrl+'"><img alt="'+c.pName+'" src="'+c.pImg+'_50.jpg"></a></p><p class="name"><a target="_blank" title="'+c.pName+'" href="'+c.pUrl+'">'+c.pName+'</a></p><p class="price ancyPrice"><span></span></p><p class="btn"><a href="javascript:void(0);" class="history-page-compare-checkbox" sid="'+c.skuId+'" pid="'+c.pId+'" track="对比栏:最近浏览:对比"></a></p></li>';t+='<li class="item"><input class="productInfo" pId="'+c.pId+'" sId="'+c.skuId+'" type="hidden"/><p class="item-pic"><a href="'+c.pUrl+'" target="_blank"><img src="//img.gomein.net.cn/images/grey.gif" gome-src="'+c.pImg+'_80.jpg" alt=""></a></p><p class="item-price ancyPrice"><span></span></p></li>'}}o.empty().html('<ul class="clearfix js-csum">'+i+"</ul>");r.empty().html(t);searchBase.asyncMaima(r,true);e.checked();e.blinds();e.moving()},error:function(){}})},checked:function(){var e=$(".history-page-compare-checkbox");var a=compare.collectSIds();if(e.length>0){e.each(function(){var e=$(this);var o=e.attr("sid");e.removeClass("click");for(var r=0;a!==null&&r<a.length;r++){if(o==a[r]){e.addClass("click")}}})}},sliblings:function(){var e=$(".compare-bar .hd li");e.eq(0).addClass("hover").siblings().removeClass("hover");$(".compare-bar .bd .items").hide().eq(0).show()},blinds:function(){$(".newly-cont li.goods .btn a").unbind("click");$(".newly-cont li.goods .btn a").bind("click",function(){var e=$(this).hasClass("click");var a=$(this).attr("sid");var o=$(this).attr("pid");if(e){compare.delElement($(this));historyView.sliblings();$(this).removeClass("click")}else{compare.addToCompare(o,a);historyView.sliblings();var r=$(".display-page-compare-checkbox");if(r.length>0){r.each(function(){var e=$(this);var o=e.parents(".item-tab-warp").attr("sid");if(a==o){e.addClass("click");return false}})}}})},moving:function(){var e=this;var a=$(".js-csum").find("li").length,o=$(".js-cnext"),r=$(".js-cprev"),i=$(".js-csum"),t=860,s=Math.round(a/4);if(a<5){o.hide();r.hide()}o.unbind();o.bind("mouseup",function(){if(!o.hasClass("disable")){e.moveindex++}i.stop(false,true).animate({left:t*e.moveindex*-1},300,function(){if(e.moveindex>=s-1){o.addClass("disable");r.removeClass("disable")}else if(e.moveindex<s-1&&e.moveindex>0){o.removeClass("disable");r.removeClass("disable")}else if(e.moveindex<=0){r.addClass("disable");o.removeClass("disable")}})});r.unbind();r.bind("mouseup",function(){if(!r.hasClass("disable")){e.moveindex--}else{}i.stop(false,true).animate({left:t*e.moveindex*-1},300,function(){if(e.moveindex>=s-1){o.addClass("disable");r.removeClass("disable")}else if(e.moveindex<s-1&&e.moveindex>0){o.removeClass("disable");r.removeClass("disable")}else if(e.moveindex<=0){r.addClass("disable");o.removeClass("disable")}})})}};var tool={setCookie:function(e,a){$.cookie(e,a,{expires:30,path:"/",domain:searop_domian})},getCookieValue:function(e){return $.cookie(e)},cookieContain:function(e,a){if(e.indexOf(a)>-1){return true}else{return false}},cookieSize:function(e,a){var o=this.getCookieValue(e);if(o==null)return 0;var r=o.split(a);return r.length},delCookieById:function(e){var a=null;var o=tool.getCookieValue("compare");if(o==null)return null;var r=o.split("|");for(var i=0;r!=null&&i<r.length;i++){if(!this.cookieContain(r[i],e)){if(a==null)a=r[i];else a=a+"|"+r[i]}}return a},clear:function(e){$.cookie(e,null,{expires:30,path:"/",domain:searop_domian})},elementStyle:function(e){var a=$("."+e).attr("style");if(a=="display: block;"||a=="")return"block";else return"none"}};compare.compareInit();historyView.historyTemplate();function clearCompare(){compare.clearCompareBox()}function del(e){compare.delElement(e)}$(".compare-bar .hd .more").click(function(){var e=compare.collectSIds();if(e==null){$("#backCompare").hide();$("#f-compare .f-compare-text").hide();$("#j-backtop").addClass("after");tool.setCookie("g_co","hide")}else{$("#backCompare").show();$("#f-compare .f-compare-text").show();$("#j-backtop").removeClass("after");tool.setCookie("g_co","hide")}$(".compare-bar").hide("1200")});$(".compare_lesat").bind("click",function(){$(this).addClass("hover").siblings("li").removeClass("hover");$(".compare-bd").hide();$(".js-cbox").show();historyView.historyTemplate()});$(".compare_li").bind("click",function(){$(this).addClass("hover").siblings("li").removeClass("hover");$(".compare-bd").show();$(".js-cbox").hide()});